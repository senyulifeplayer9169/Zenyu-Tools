<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Compound Interest Calculator (Auto-Farming Cheat Code)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root { --primary: #00ff41; --bg: #0d0d0d; --card: #1a1a1a; --text: #e0e0e0; --accent: #00ccff; --interest: #ffbb00; }
        /* åŠ ä¸Šäº† position: relative è®©å³ä¸Šè§’æŒ‰é’®èƒ½å›ºå®š */
        body { background: var(--bg); color: var(--text); font-family: 'Courier New', Courier, monospace; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 20px; overflow-x: hidden; position: relative;}
        
        /* ä¸“å±è®¡ç®—å™¨éŸ³ä¹å¼€å…³ (èµ›åšè“) */
        .music-toggle { position: absolute; top: 15px; right: 15px; background: #000; border: 1px solid var(--accent); color: var(--accent); font-size: 0.7rem; padding: 5px 10px; border-radius: 5px; cursor: pointer; font-family: 'Segoe UI', sans-serif; transition: all 0.3s; z-index: 10; box-shadow: 0 0 5px rgba(0, 204, 255, 0.3);}
        .music-active { background: var(--accent); color: #000; box-shadow: 0 0 15px var(--accent); font-weight: bold;}

        .header { text-align: center; margin-bottom: 20px; margin-top: 30px;}
        h1 { margin: 0; color: var(--primary); text-transform: uppercase; letter-spacing: 2px; font-size: 1.8rem; text-shadow: 0 0 10px rgba(0, 255, 65, 0.5);}
        .sub-title { font-size: 0.8rem; color: #888; font-family: 'Segoe UI', sans-serif;}

        .container { display: grid; grid-template-columns: 1fr; gap: 20px; max-width: 900px; width: 100%; }
        @media (min-width: 768px) { .container { grid-template-columns: 1fr 1fr; } }

        .panel { background: var(--card); border: 1px solid #333; border-radius: 12px; padding: 25px; box-shadow: 0 5px 20px rgba(0,0,0,0.5); position: relative;}
        
        /* æ§åˆ¶å°æ ·å¼ */
        .control-group { margin-bottom: 25px; }
        .control-group label { display: flex; justify-content: space-between; align-items: center; font-weight: bold; margin-bottom: 10px; font-size: 0.9rem; color: #ccc; text-transform: uppercase;}
        
        /* å¯è¾“å…¥æ•°å€¼æ ·å¼ */
        .input-wrapper { display: flex; align-items: center; justify-content: flex-end; }
        .input-wrapper span { color: var(--primary); font-weight: bold; text-shadow: 0 0 5px var(--primary); margin-right: 5px; font-size: 1.1rem; }
        .val-input { background: transparent; border: none; border-bottom: 1px dashed #333; color: var(--primary); text-shadow: 0 0 5px var(--primary); font-size: 1.1rem; font-family: 'Courier New', Courier, monospace; text-align: right; width: 80px; outline: none; font-weight: bold; transition: border-color 0.3s; }
        .val-input:focus { border-bottom: 1px solid var(--primary); }
        /* éšè—è¾“å…¥æ¡†ä¸Šä¸‹ç®­å¤´ */
        .val-input::-webkit-outer-spin-button, .val-input::-webkit-inner-spin-button { -webkit-appearance: none; margin: 0; }
        .val-input[type=number] { -moz-appearance: textfield; }

        /* èµ›åšæœ‹å…‹é£æ»‘å— */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; }
        input[type=range]:focus { outline: none; }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 6px; cursor: pointer; background: #333; border-radius: 3px; border: 1px solid #111; }
        input[type=range]::-webkit-slider-thumb { border: 2px solid #000; height: 18px; width: 18px; border-radius: 50%; background: var(--primary); cursor: pointer; -webkit-appearance: none; margin-top: -7px; box-shadow: 0 0 10px var(--primary);}
        
        /* ç»“æœé¢æ¿ */
        .result-box { text-align: center; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px dashed #333;}
        .total-title { font-size: 1rem; color: #888; margin-bottom: 5px; text-transform: uppercase;}
        .total-value { font-size: 2.5rem; color: var(--primary); font-weight: bold; text-shadow: 0 0 15px rgba(0, 255, 65, 0.6); font-family: 'Segoe UI', sans-serif;}
        
        .breakdown { display: flex; justify-content: space-between; margin-top: 15px; }
        .stat { text-align: center; width: 48%; background: #111; padding: 10px; border-radius: 8px; border: 1px solid #222;}
        .stat-title { font-size: 0.7rem; color: #888; display: block; margin-bottom: 5px;}
        .stat-val-cap { color: var(--accent); font-weight: bold; font-size: 1.1rem; font-family: 'Segoe UI', sans-serif;}
        .stat-val-int { color: var(--interest); font-weight: bold; font-size: 1.1rem; font-family: 'Segoe UI', sans-serif; text-shadow: 0 0 5px rgba(255, 187, 0, 0.4);}

        /* å›¾è¡¨å®¹å™¨ */
        .chart-container { position: relative; height: 250px; width: 100%; margin-top: 20px;}

        .back-btn { display: inline-block; margin-top: 30px; color: #888; text-decoration: none; border: 1px solid #444; padding: 8px 15px; border-radius: 5px; font-size: 0.8rem; transition: all 0.3s; }
        .back-btn:hover { color: var(--text); border-color: var(--text); background: #333; }
        
        .warning { font-size: 0.65rem; color: #555; text-align: center; margin-top: 15px; font-family: 'Segoe UI', sans-serif;}
    </style>
</head>
<body>

    <audio id="calcBgm" src="calc-bgm.mp3" loop></audio>
    <div id="musicBtn" class="music-toggle" onclick="toggleMusic()">ğŸ”‡ BGM: OFF</div>

    <div class="header">
        <h1 style="font-size: 1.5rem;">COMPOUND INTEREST CALCULATOR</h1>
        <div class="sub-title" style="color: var(--accent); margin-top: 8px; font-weight: bold; letter-spacing: 1px; font-family: 'Courier New', monospace;">System Glitch : Auto-Farming Cheat Code</div>
        <div class="sub-title" style="margin-top: 5px;">ç³»ç»Ÿæ¼æ´ï¼šä¸–ç•Œç¬¬å…«å¤§å¥‡è¿¹ (å¤åˆ©)</div>
    </div>

    <div class="container">
        <div class="panel">
            <div class="control-group">
                <label>
                    <span>Initial Coins (åˆå§‹èµ„é‡‘)</span>
                    <div class="input-wrapper">
                        <span>$</span>
                        <input type="number" class="val-input" id="num-principal" value="0">
                    </div>
                </label>
                <input type="range" id="range-principal" min="0" max="100000" step="500" value="0">
            </div>

            <div class="control-group">
                <label>
                    <span>Auto-Farming (æ¯æœˆå®šæŠ•)</span>
                    <div class="input-wrapper">
                        <span>$</span>
                        <input type="number" class="val-input" id="num-monthly" value="480">
                    </div>
                </label>
                <input type="range" id="range-monthly" min="0" max="5000" step="50" value="480">
            </div>

            <div class="control-group">
                <label>
                    <span>Sys Return (å¹´åŒ–å›æŠ¥ç‡)</span>
                    <div class="input-wrapper">
                        <input type="number" class="val-input" id="num-rate" value="6.0" step="0.1" style="width: 50px;">
                        <span style="margin-left: 5px; margin-right: 0;">%</span>
                    </div>
                </label>
                <input type="range" id="range-rate" min="1" max="15" step="0.5" value="6.0">
            </div>

            <div class="control-group">
                <label>
                    <span>Time Warp (æŠ•èµ„å¹´é™)</span>
                    <div class="input-wrapper">
                        <input type="number" class="val-input" id="num-years" value="30" style="width: 50px;">
                        <span style="margin-left: 5px; margin-right: 0; font-size: 0.9rem;">YRS</span>
                    </div>
                </label>
                <input type="range" id="range-years" min="1" max="40" step="1" value="30">
            </div>
            
            <p style="font-size: 0.75rem; color: #666; font-style: italic;">* é»˜è®¤è®¾ç½®: EPF å¼ºåˆ¶å›è¡€æœºåˆ¶ (æœˆè–ª $2000 çš„å‘˜å·¥æ¯æœˆè‡ªåŠ¨å­˜å…¥ $480ï¼Œå†å²å¹³å‡åˆ©æ¯ 6%)</p>
        </div>

        <div class="panel">
            <div class="result-box">
                <div class="total-title">Total Future Value / æœ€ç»ˆèº«ä»·</div>
                <div class="total-value" id="total-result">$0.00</div>
                
                <div class="breakdown">
                    <div class="stat">
                        <span class="stat-title">ä½ çš„æœ¬é‡‘ (Your Capital)</span>
                        <span class="stat-val-cap" id="total-principal">$0.00</span>
                    </div>
                    <div class="stat" style="border-color: rgba(255, 187, 0, 0.3);">
                        <span class="stat-title">åˆ©æ¯ (Interest)</span>
                        <span class="stat-val-int" id="total-interest">$0.00</span>
                    </div>
                </div>
            </div>

            <div class="chart-container">
                <canvas id="compoundChart"></canvas>
            </div>
            
            <div class="warning">For educational purposes only. Not financial advice. (çº¯å±æ•°å­¦è®¡ç®—ï¼ŒéæŠ•èµ„å»ºè®®)</div>
        </div>
    </div>

    <a href="index.html" class="back-btn">â¬… è¿”å›å¤§å… (Back to Lobby)</a>

    <script>
        // --- éŸ³ä¹æ’­æ”¾å™¨é€»è¾‘ ---
        let musicPlaying = false;
        function toggleMusic() {
            const audio = document.getElementById('calcBgm');
            const btn = document.getElementById('musicBtn');
            if (musicPlaying) {
                audio.pause(); 
                musicPlaying = false;
                btn.innerHTML = "ğŸ”‡ BGM: OFF"; 
                btn.classList.remove("music-active");
            } else {
                audio.volume = 0.3; // éŸ³é‡é”å®šåœ¨ 30%
                audio.play().then(() => {
                    musicPlaying = true; 
                    btn.innerHTML = "ğŸµ BGM: ON"; 
                    btn.classList.add("music-active");
                }).catch(e => console.log("Click required to play audio"));
            }
        }
        
        // ç›‘å¬ç”¨æˆ·ç¬¬ä¸€æ¬¡ç‚¹å‡»ï¼Œè‡ªåŠ¨è§¦å‘æ’­æ”¾ (çªç ´æµè§ˆå™¨é™åˆ¶)
        document.body.addEventListener('click', function() { 
            if (!musicPlaying) toggleMusic(); 
        }, { once: true });


        // --- è®¡ç®—å™¨ä¸å›¾è¡¨é€»è¾‘ ---
        const formatMoney = (num) => '$' + num.toLocaleString('en-US', {minimumFractionDigits: 0, maximumFractionDigits: 0});
        let chartInstance = null;

        // åŒå‘ç»‘å®šä¸è‡ªåŠ¨æ‰©å®¹åŠŸèƒ½ (No Limit)
        function syncInputs(numId, rangeId) {
            const numEl = document.getElementById(numId);
            const rangeEl = document.getElementById(rangeId);

            // å½“æ‰‹åŠ¨è¾“å…¥æ•°å€¼æ—¶
            numEl.addEventListener('input', () => {
                let val = parseFloat(numEl.value) || 0;
                let currentMax = parseFloat(rangeEl.max);
                
                // åŠ¨æ€æ‰©å®¹ä¸Šé™ï¼šå¦‚æœè¾“å…¥å€¼å¤§äºæ»‘å—ä¸Šé™ï¼Œä¸Šé™è‡ªåŠ¨ç¿»å€
                if (val > currentMax) {
                    rangeEl.max = Math.ceil(val * 1.5); // æ‰©å……ä¸ºè¾“å…¥çš„1.5å€ä»¥ä¿æŒæ»‘åŠ¨ç©ºé—´
                }
                rangeEl.value = val;
                updateCalculator();
            });

            // å½“æ‹–åŠ¨æ»‘å—æ—¶
            rangeEl.addEventListener('input', () => {
                numEl.value = rangeEl.value;
                updateCalculator();
            });
        }

        // ç»‘å®šæ‰€æœ‰å››ä¸ªå‚æ•°
        syncInputs('num-principal', 'range-principal');
        syncInputs('num-monthly', 'range-monthly');
        syncInputs('num-rate', 'range-rate');
        syncInputs('num-years', 'range-years');

        function updateCalculator() {
            // è·å–å½“å‰å€¼
            const P = parseFloat(document.getElementById('num-principal').value) || 0;
            const PMT = parseFloat(document.getElementById('num-monthly').value) || 0;
            const r = (parseFloat(document.getElementById('num-rate').value) || 0) / 100;
            const t = parseInt(document.getElementById('num-years').value) || 0;

            // è®¡ç®—å¤åˆ©ä¸å›¾è¡¨æ•°æ®
            let labels = [];
            let principalData = [];
            let interestData = [];
            
            let currentPrincipal = P;
            let currentTotal = P;
            const monthlyRate = r / 12;

            for (let i = 0; i <= t; i++) {
                labels.push('Yr ' + i);
                if (i === 0) {
                    principalData.push(currentPrincipal);
                    interestData.push(0);
                } else {
                    for(let m = 0; m < 12; m++) {
                        currentTotal += PMT;
                        currentTotal *= (1 + monthlyRate);
                    }
                    currentPrincipal += (PMT * 12);
                    
                    principalData.push(currentPrincipal);
                    interestData.push(currentTotal - currentPrincipal);
                }
            }

            const finalTotal = currentTotal;
            const finalPrincipal = currentPrincipal;
            const finalInterest = finalTotal - finalPrincipal;

            // æ›´æ–°å³ä¾§ç»“æœæ˜¾ç¤º
            document.getElementById('total-result').innerText = formatMoney(finalTotal);
            document.getElementById('total-principal').innerText = formatMoney(finalPrincipal);
            document.getElementById('total-interest').innerText = formatMoney(finalInterest);

            // æ›´æ–°å›¾è¡¨
            updateChart(labels, principalData, interestData);
        }

        function updateChart(labels, principalData, interestData) {
            const ctx = document.getElementById('compoundChart').getContext('2d');
            
            if (chartInstance) {
                chartInstance.data.labels = labels;
                chartInstance.data.datasets[0].data = principalData;
                chartInstance.data.datasets[1].data = interestData;
                chartInstance.update();
            } else {
                Chart.defaults.color = '#888';
                Chart.defaults.font.family = "'Courier New', Courier, monospace";
                
                chartInstance = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [
                            {
                                label: 'æœ¬é‡‘ (Capital)',
                                data: principalData,
                                borderColor: '#00ccff',
                                backgroundColor: 'rgba(0, 204, 255, 0.1)',
                                fill: true,
                                tension: 0.4,
                                pointRadius: 0
                            },
                            {
                                label: 'åˆ©æ¯ (Interest)',
                                data: interestData,
                                borderColor: '#ffbb00',
                                backgroundColor: 'rgba(255, 187, 0, 0.2)',
                                fill: true,
                                tension: 0.4,
                                pointRadius: 0
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        interaction: { mode: 'index', intersect: false },
                        plugins: {
                            legend: { position: 'top', labels: { boxWidth: 10 } },
                            tooltip: { 
                                callbacks: { 
                                    label: function(context) { return context.dataset.label + ': $ ' + Math.round(context.raw).toLocaleString(); }
                                } 
                            }
                        },
                        scales: {
                            x: { grid: { color: '#222' } },
                            y: { stacked: true, grid: { color: '#222' }, ticks: { callback: function(value) { return value >= 1000 ? (value/1000) + 'k' : value; } } }
                        }
                    }
                });
            }
        }

        // åˆå§‹åŒ–æ‰§è¡Œä¸€æ¬¡è®¡ç®—
        updateCalculator();
    </script>
</body>
</html>